"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.load = void 0;

var _graphql = require("graphql");

var defaultGraphQLTypes = _interopRequireWildcard(require("./defaultGraphQLTypes"));

var objectsMutations = _interopRequireWildcard(require("./objectsMutations"));

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

const load = (parseGraphQLSchema, parseClass) => {
  const className = parseClass.className;
  const classGraphQLInputType = parseGraphQLSchema.parseClassTypes[className].classGraphQLInputType;
  const fields = {
    description: 'These are the fields of the object.',
    type: classGraphQLInputType
  };
  const classGraphQLInputTypeFields = classGraphQLInputType.getFields();

  const transformTypes = fields => {
    if (fields) {
      Object.keys(fields).forEach(field => {
        if (classGraphQLInputTypeFields[field]) {
          switch (classGraphQLInputTypeFields[field].type) {
            case defaultGraphQLTypes.GEO_POINT:
              fields[field].__type = 'GeoPoint';
              break;

            case defaultGraphQLTypes.POLYGON:
              fields[field] = {
                __type: 'Polygon',
                coordinates: fields[field].map(geoPoint => [geoPoint.latitude, geoPoint.longitude])
              };
              break;
          }
        }
      });
    }
  };

  const createGraphQLMutationName = `create${className}`;
  parseGraphQLSchema.graphQLObjectsMutations[createGraphQLMutationName] = {
    description: `The ${createGraphQLMutationName} mutation can be used to create a new object of the ${className} class.`,
    args: {
      fields
    },
    type: new _graphql.GraphQLNonNull(defaultGraphQLTypes.CREATE_RESULT),

    async resolve(_source, args, context) {
      try {
        const {
          fields
        } = args;
        const {
          config,
          auth,
          info
        } = context;
        transformTypes(fields);
        return await objectsMutations.createObject(className, fields, config, auth, info);
      } catch (e) {
        parseGraphQLSchema.handleError(e);
      }
    }

  };
  const updateGraphQLMutationName = `update${className}`;
  parseGraphQLSchema.graphQLObjectsMutations[updateGraphQLMutationName] = {
    description: `The ${updateGraphQLMutationName} mutation can be used to update an object of the ${className} class.`,
    args: {
      objectId: defaultGraphQLTypes.OBJECT_ID_ATT,
      fields
    },
    type: defaultGraphQLTypes.UPDATE_RESULT,

    async resolve(_source, args, context) {
      try {
        const {
          objectId,
          fields
        } = args;
        const {
          config,
          auth,
          info
        } = context;
        transformTypes(fields);
        return await objectsMutations.updateObject(className, objectId, fields, config, auth, info);
      } catch (e) {
        parseGraphQLSchema.handleError(e);
      }
    }

  };
  const deleteGraphQLMutationName = `delete${className}`;
  parseGraphQLSchema.graphQLObjectsMutations[deleteGraphQLMutationName] = {
    description: `The ${deleteGraphQLMutationName} mutation can be used to delete an object of the ${className} class.`,
    args: {
      objectId: defaultGraphQLTypes.OBJECT_ID_ATT
    },
    type: new _graphql.GraphQLNonNull(_graphql.GraphQLBoolean),

    async resolve(_source, args, context) {
      try {
        const {
          objectId
        } = args;
        const {
          config,
          auth,
          info
        } = context;
        return await objectsMutations.deleteObject(className, objectId, config, auth, info);
      } catch (e) {
        parseGraphQLSchema.handleError(e);
      }
    }

  };
};

exports.load = load;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HcmFwaFFML2xvYWRlcnMvcGFyc2VDbGFzc011dGF0aW9ucy5qcyJdLCJuYW1lcyI6WyJsb2FkIiwicGFyc2VHcmFwaFFMU2NoZW1hIiwicGFyc2VDbGFzcyIsImNsYXNzTmFtZSIsImNsYXNzR3JhcGhRTElucHV0VHlwZSIsInBhcnNlQ2xhc3NUeXBlcyIsImZpZWxkcyIsImRlc2NyaXB0aW9uIiwidHlwZSIsImNsYXNzR3JhcGhRTElucHV0VHlwZUZpZWxkcyIsImdldEZpZWxkcyIsInRyYW5zZm9ybVR5cGVzIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJmaWVsZCIsImRlZmF1bHRHcmFwaFFMVHlwZXMiLCJHRU9fUE9JTlQiLCJfX3R5cGUiLCJQT0xZR09OIiwiY29vcmRpbmF0ZXMiLCJtYXAiLCJnZW9Qb2ludCIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwiY3JlYXRlR3JhcGhRTE11dGF0aW9uTmFtZSIsImdyYXBoUUxPYmplY3RzTXV0YXRpb25zIiwiYXJncyIsIkdyYXBoUUxOb25OdWxsIiwiQ1JFQVRFX1JFU1VMVCIsInJlc29sdmUiLCJfc291cmNlIiwiY29udGV4dCIsImNvbmZpZyIsImF1dGgiLCJpbmZvIiwib2JqZWN0c011dGF0aW9ucyIsImNyZWF0ZU9iamVjdCIsImUiLCJoYW5kbGVFcnJvciIsInVwZGF0ZUdyYXBoUUxNdXRhdGlvbk5hbWUiLCJvYmplY3RJZCIsIk9CSkVDVF9JRF9BVFQiLCJVUERBVEVfUkVTVUxUIiwidXBkYXRlT2JqZWN0IiwiZGVsZXRlR3JhcGhRTE11dGF0aW9uTmFtZSIsIkdyYXBoUUxCb29sZWFuIiwiZGVsZXRlT2JqZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxJQUFJLEdBQUcsQ0FBQ0Msa0JBQUQsRUFBcUJDLFVBQXJCLEtBQW9DO0FBQy9DLFFBQU1DLFNBQVMsR0FBR0QsVUFBVSxDQUFDQyxTQUE3QjtBQUVBLFFBQU1D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QU1JLGdCQUFnQixDQUFDVyxZQUFqQixDQUNYNUMsU0FEVyxFQUVYc0MsUUFGVyxFQUdYUixNQUhXLEVBSVhDLElBSlcsRUFLWEMsSUFMVyxDQUFiO0FBT0QsT0FYRCxDQVdFLE9BQU9HLENBQVAsRUFBVTtBQUNWckMsUUFBQUEsa0JBQWtCLENBQUNzQyxXQUFuQixDQUErQkQsQ0FBL0I7QUFDRDtBQUNGOztBQXJCcUUsR0FBeEU7QUF1QkQsQ0FsSEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHcmFwaFFMTm9uTnVsbCwgR3JhcGhRTEJvb2xlYW4gfSBmcm9tICdncmFwaHFsJztcbmltcG9ydCAqIGFzIGRlZmF1bHRHcmFwaFFMVHlwZXMgZnJvbSAnLi9kZWZhdWx0R3JhcGhRTFR5cGVzJztcbmltcG9ydCAqIGFzIG9iamVjdHNNdXRhdGlvbnMgZnJvbSAnLi9vYmplY3RzTXV0YXRpb25zJztcblxuY29uc3QgbG9hZCA9IChwYXJzZUdyYXBoUUxTY2hlbWEsIHBhcnNlQ2xhc3MpID0+IHtcbiAgY29uc3QgY2xhc3NOYW1lID0gcGFyc2VDbGFzcy5jbGFzc05hbWU7XG5cbiAgY29uc3QgY2xhc3NHcmFwaFFMSW5wdXRUeXBlID1cbiAgICBwYXJzZUdyYXBoUUxTY2hlbWEucGFyc2VDbGFzc1R5cGVzW2NsYXNzTmFtZV0uY2xhc3NHcmFwaFFMSW5wdXRUeXBlO1xuICBjb25zdCBmaWVsZHMgPSB7XG4gICAgZGVzY3JpcHRpb246ICdUaGVzZSBhcmUgdGhlIGZpZWxkcyBvZiB0aGUgb2JqZWN0LicsXG4gICAgdHlwZTogY2xhc3NHcmFwaFFMSW5wdXRUeXBlLFxuICB9O1xuICBjb25zdCBjbGFzc0dyYXBoUUxJbnB1dFR5cGVGaWVsZHMgPSBjbGFzc0dyYXBoUUxJbnB1dFR5cGUuZ2V0RmllbGRzKCk7XG5cbiAgY29uc3QgdHJhbnNmb3JtVHlwZXMgPSBmaWVsZHMgPT4ge1xuICAgIGlmIChmaWVsZHMpIHtcbiAgICAgIE9iamVjdC5rZXlzKGZpZWxkcykuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICAgIGlmIChjbGFzc0dyYXBoUUxJbnB1dFR5cGVGaWVsZHNbZmllbGRdKSB7XG4gICAgICAgICAgc3dpdGNoIChjbGFzc0dyYXBoUUxJbnB1dFR5cGVGaWVsZHNbZmllbGRdLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgZGVmYXVsdEdyYXBoUUxUeXBlcy5HRU9fUE9JTlQ6XG4gICAgICAgICAgICAgIGZpZWxkc1tmaWVsZF0uX190eXBlID0gJ0dlb1BvaW50JztcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGRlZmF1bHRHcmFwaFFMVHlwZXMuUE9MWUdPTjpcbiAgICAgICAgICAgICAgZmllbGRzW2ZpZWxkXSA9IHtcbiAgICAgICAgICAgICAgICBfX3R5cGU6ICdQb2x5Z29uJyxcbiAgICAgICAgICAgICAgICBjb29yZGluYXRlczogZmllbGRzW2ZpZWxkXS5tYXAoZ2VvUG9pbnQgPT4gW1xuICAgICAgICAgICAgICAgICAgZ2VvUG9pbnQubGF0aXR1ZGUsXG4gICAgICAgICAgICAgICAgICBnZW9Qb2ludC5sb25naXR1ZGUsXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZUdyYXBoUUxNdXRhdGlvbk5hbWUgPSBgY3JlYXRlJHtjbGFzc05hbWV9YDtcbiAgcGFyc2VHcmFwaFFMU2NoZW1hLmdyYXBoUUxPYmplY3RzTXV0YXRpb25zW2NyZWF0ZUdyYXBoUUxNdXRhdGlvbk5hbWVdID0ge1xuICAgIGRlc2NyaXB0aW9uOiBgVGhlICR7Y3JlYXRlR3JhcGhRTE11dGF0aW9uTmFtZX0gbXV0YXRpb24gY2FuIGJlIHVzZWQgdG8gY3JlYXRlIGEgbmV3IG9iamVjdCBvZiB0aGUgJHtjbGFzc05hbWV9IGNsYXNzLmAsXG4gICAgYXJnczoge1xuICAgICAgZmllbGRzLFxuICAgIH0sXG4gICAgdHlwZTogbmV3IEdyYXBoUUxOb25OdWxsKGRlZmF1bHRHcmFwaFFMVHlwZXMuQ1JFQVRFX1JFU1VMVCksXG4gICAgYXN5bmMgcmVzb2x2ZShfc291cmNlLCBhcmdzLCBjb250ZXh0KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGZpZWxkcyB9ID0gYXJncztcbiAgICAgICAgY29uc3QgeyBjb25maWcsIGF1dGgsIGluZm8gfSA9IGNvbnRleHQ7XG5cbiAgICAgICAgdHJhbnNmb3JtVHlwZXMoZmllbGRzKTtcblxuICAgICAgICByZXR1cm4gYXdhaXQgb2JqZWN0c011dGF0aW9ucy5jcmVhdGVPYmplY3QoXG4gICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgIGZpZWxkcyxcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgYXV0aCxcbiAgICAgICAgICBpbmZvXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHBhcnNlR3JhcGhRTFNjaGVtYS5oYW5kbGVFcnJvcihlKTtcbiAgICAgIH1cbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHVwZGF0ZUdyYXBoUUxNdXRhdGlvbk5hbWUgPSBgdXBkYXRlJHtjbGFzc05hbWV9YDtcbiAgcGFyc2VHcmFwaFFMU2NoZW1hLmdyYXBoUUxPYmplY3RzTXV0YXRpb25zW3VwZGF0ZUdyYXBoUUxNdXRhdGlvbk5hbWVdID0ge1xuICAgIGRlc2NyaXB0aW9uOiBgVGhlICR7dXBkYXRlR3JhcGhRTE11dGF0aW9uTmFtZX0gbXV0YXRpb24gY2FuIGJlIHVzZWQgdG8gdXBkYXRlIGFuIG9iamVjdCBvZiB0aGUgJHtjbGFzc05hbWV9IGNsYXNzLmAsXG4gICAgYXJnczoge1xuICAgICAgb2JqZWN0SWQ6IGRlZmF1bHRHcmFwaFFMVHlwZXMuT0JKRUNUX0lEX0FUVCxcbiAgICAgIGZpZWxkcyxcbiAgICB9LFxuICAgIHR5cGU6IGRlZmF1bHRHcmFwaFFMVHlwZXMuVVBEQVRFX1JFU1VMVCxcbiAgICBhc3luYyByZXNvbHZlKF9zb3VyY2UsIGFyZ3MsIGNvbnRleHQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgb2JqZWN0SWQsIGZpZWxkcyB9ID0gYXJncztcbiAgICAgICAgY29uc3QgeyBjb25maWcsIGF1dGgsIGluZm8gfSA9IGNvbnRleHQ7XG5cbiAgICAgICAgdHJhbnNmb3JtVHlwZXMoZmllbGRzKTtcblxuICAgICAgICByZXR1cm4gYXdhaXQgb2JqZWN0c011dGF0aW9ucy51cGRhdGVPYmplY3QoXG4gICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgIG9iamVjdElkLFxuICAgICAgICAgIGZpZWxkcyxcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgYXV0aCxcbiAgICAgICAgICBpbmZvXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHBhcnNlR3JhcGhRTFNjaGVtYS5oYW5kbGVFcnJvcihlKTtcbiAgICAgIH1cbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IGRlbGV0ZUdyYXBoUUxNdXRhdGlvbk5hbWUgPSBgZGVsZXRlJHtjbGFzc05hbWV9YDtcbiAgcGFyc2VHcmFwaFFMU2NoZW1hLmdyYXBoUUxPYmplY3RzTXV0YXRpb25zW2RlbGV0ZUdyYXBoUUxNdXRhdGlvbk5hbWVdID0ge1xuICAgIGRlc2NyaXB0aW9uOiBgVGhlICR7ZGVsZXRlR3JhcGhRTE11dGF0aW9uTmFtZX0gbXV0YXRpb24gY2FuIGJlIHVzZWQgdG8gZGVsZXRlIGFuIG9iamVjdCBvZiB0aGUgJHtjbGFzc05hbWV9IGNsYXNzLmAsXG4gICAgYXJnczoge1xuICAgICAgb2JqZWN0SWQ6IGRlZmF1bHRHcmFwaFFMVHlwZXMuT0JKRUNUX0lEX0FUVCxcbiAgICB9LFxuICAgIHR5cGU6IG5ldyBHcmFwaFFMTm9uTnVsbChHcmFwaFFMQm9vbGVhbiksXG4gICAgYXN5bmMgcmVzb2x2ZShfc291cmNlLCBhcmdzLCBjb250ZXh0KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IG9iamVjdElkIH0gPSBhcmdzO1xuICAgICAgICBjb25zdCB7IGNvbmZpZywgYXV0aCwgaW5mbyB9ID0gY29udGV4dDtcblxuICAgICAgICByZXR1cm4gYXdhaXQgb2JqZWN0c011dGF0aW9ucy5kZWxldGVPYmplY3QoXG4gICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgIG9iamVjdElkLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBhdXRoLFxuICAgICAgICAgIGluZm9cbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcGFyc2VHcmFwaFFMU2NoZW1hLmhhbmRsZUVycm9yKGUpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG59O1xuXG5leHBvcnQgeyBsb2FkIH07XG4iXX0=